<div id="article_content" class="article_content clearfix">
        <link rel="stylesheet" href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/ck_htmledit_views-1a85854398.css">
                <div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    

<h2><a name="t1"></a><a id="1__5"></a>1 知识点</h2> 
<ul><li>OpenCV 编译</li><li>使用 OpenCV 处理图片、视频</li><li>图片转字符画原理</li><li>守护线程</li><li>光标定位转义编码</li></ul> 
<h2><a name="t2"></a><a id="2__11"></a>2 实验环境</h2> 
<ul><li>python 3.5</li><li>opencv-python-3.4.1</li><li>pyprind-2.11.2</li></ul> 
<h1><a name="t3"></a><a id="_17"></a>实验步骤</h1> 
<h2><a name="t4"></a><a id="_19"></a>环境搭建</h2> 
<p>关于上面的那几个包，opencv-<a href="https://so.csdn.net/so/search?from=pc_blog_highlight&amp;q=python" target="_blank" class="hl hl-1">python</a>我已经在上一篇讲过如何安装，而pyprind是一个动态进度条的库，PyPrind 没有比较官方的网址，其详细使用教程就放在 GitHub 主页上: https://github.com/rasbt/pyprind ，有兴趣的可以自己去瞅瞅一些其他使用的方法，非常的简单易用。我这里也写个例子就基本懂了：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">n <span class="token operator">=</span> <span class="token number">50</span>
bar <span class="token operator">=</span> pyprind<span class="token punctuation">.</span>ProgBar<span class="token punctuation">(</span>n<span class="token punctuation">,</span>monitor<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span>
    bar<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="复制（为作者贡献原力分）" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li></ul></pre> 
<p><img src="https://img-blog.csdnimg.cn/20200531223002613.gif#pic_center" alt="在这里插入图片描述"></p> 
<h2><a name="t5"></a><a id="_31"></a>代码实现</h2> 
<p>因为本篇是视频转字符动画，其实中间还省略了一个，就是图片，而关于图片转字符画的原理，可以看一下我去年有写过一篇 <a href="https://blog.csdn.net/submarineas/article/details/86586393">Python利用argparse模块图片转字符文件</a>，具体的原理在那篇中有提到，我这里直接把那边写的截图为：</p> 
<p><img src="https://img-blog.csdnimg.cn/20200531224330110.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1Ym1hcmluZWFz,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
<p>所以代码为：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">import</span> sys
<span class="token keyword">import</span> os
<span class="token keyword">import</span> time
<span class="token keyword">import</span> threading
<span class="token triple-quoted-string string">"""
termios和tty库只存在于Linux服务器中的python库，win下相同功能的库为msvcrt库。但因为时间问题我没研究了
"""</span>
<span class="token keyword">import</span> termios
<span class="token keyword">import</span> tty
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> pyprind

<span class="token keyword">class</span> <span class="token class-name">CharFrame</span><span class="token punctuation">:</span>

    ascii_char <span class="token operator">=</span> <span class="token string">"$@B%8&amp;WM#*oahkbdpqwmZO0QLCJUYXzcvunxrjft/\|()1{}[]?-_+~&lt;&gt;i!lI;:,\"^`'. "</span>

    <span class="token comment"># 像素映射到字符</span>
    <span class="token keyword">def</span> <span class="token function">pixelToChar</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> luminance<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>ascii_char<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>luminance<span class="token operator">/</span><span class="token number">256</span><span class="token operator">*</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>ascii_char<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

    <span class="token comment"># 将普通帧转为 ASCII 字符帧</span>
    <span class="token keyword">def</span> <span class="token function">convert</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> img<span class="token punctuation">,</span> limitSize<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> fill<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> wrap<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> limitSize <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">and</span> <span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> limitSize<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">or</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> limitSize<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>img<span class="token punctuation">,</span> limitSize<span class="token punctuation">,</span> interpolation<span class="token operator">=</span>cv2<span class="token punctuation">.</span>INTER_AREA<span class="token punctuation">)</span>
        ascii_frame <span class="token operator">=</span> <span class="token string">''</span>
        blank <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token keyword">if</span> fill<span class="token punctuation">:</span>
            blank <span class="token operator">+=</span> <span class="token string">' '</span><span class="token operator">*</span><span class="token punctuation">(</span>limitSize<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> wrap<span class="token punctuation">:</span>
            blank <span class="token operator">+=</span> <span class="token string">'\n'</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                ascii_frame <span class="token operator">+=</span> self<span class="token punctuation">.</span>pixelToChar<span class="token punctuation">(</span>img<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
            ascii_frame <span class="token operator">+=</span> blank
        <span class="token keyword">return</span> ascii_frame
<div class="hljs-button {2}" data-title="复制（为作者贡献原力分）" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li></ul></pre> 
<p>属性 ascii_char 可以根据你要转换的视频进行针对性调整。</p> 
<p>pixelToChar() 方法只有一个参数，其接收像素的亮度信息。需要注意的是，方法的 return 语句中的表达式使用了一个数值 256，虽然像素的亮度范围是 0~255，但若是把 256 更改为 255，那么这个表达式将有可能引发 IndexError 异常。</p> 
<p>convert() 方法有一个位置参数三个可选参数，参数 img 接收一个对象，这个对象类型是 numpy.ndarray，也就是 <a href="https://so.csdn.net/so/search?from=pc_blog_highlight&amp;q=OpenCV" target="_blank" class="hl hl-1">OpenCV</a> 打开图片返回的对象，同样，之后用 OpenCV 得到的视频的帧也是这个对象。limitSize 参数接受一个元组，表示图片的限宽限高。fill 表示是否用空格填充图片宽度至限宽，wrap 表示是否在行末添加换行符。</p> 
<p>img.shape 返回一个元组，含有图片的行数（高），列数（宽），以及颜色通道数。如果图片为灰度图则不包含颜色通道数。</p> 
<p>cv2.resize() 函数用于缩放图片大小，第一个参数为 numpy.ndarray 对象，第二个是将缩放的宽高，interpolation 参数为插值方法。可以写为：</p> 
<p>cv2.resize( src, dst, dsize, fx=0, fy=0, interpolation=INTER_LINEAR )</p> 
<pre class="prettyprint"><code class="has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">    fx，fy表示的是放缩的比例，interpolation代表差值的类型，其具体的形式主要有以下：

      INTER_NEAREST（邻近元素插值法）

      INTER_LINEAR（缺省值，双线性插值）

      INTER_AREA（使用象素关系重采样。当图像缩小时候，该方法可以避免波纹出现。当图像放大时，类似于 CV_INTER_NN 方法）

      INTER_CUBIC（立方插值）
<div class="hljs-button {2}" data-title="复制（为作者贡献原力分）" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li></ul></pre> 
<p>img[i,j] 返回图片第 i 行第 j 列像素 BGR 值构成的列表，灰度图片则为直接返回对应像素的亮度值。</p> 
<p>下面是继承自 CharFrame 的 I2Char 类：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">class</span> <span class="token class-name">I2Char</span><span class="token punctuation">(</span>CharFrame<span class="token punctuation">)</span><span class="token punctuation">:</span>

    result <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">,</span> limitSize<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> fill<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> wrap<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>genCharImage<span class="token punctuation">(</span>path<span class="token punctuation">,</span> limitSize<span class="token punctuation">,</span> fill<span class="token punctuation">,</span> wrap<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">genCharImage</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">,</span> limitSize<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> fill<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> wrap<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>path<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>IMREAD_GRAYSCALE<span class="token punctuation">)</span>
        <span class="token keyword">if</span> img <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        self<span class="token punctuation">.</span>result <span class="token operator">=</span> self<span class="token punctuation">.</span>convert<span class="token punctuation">(</span>img<span class="token punctuation">,</span> limitSize<span class="token punctuation">,</span> fill<span class="token punctuation">,</span> wrap<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> stream <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>result <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        <span class="token keyword">if</span> stream <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">and</span> os<span class="token punctuation">.</span>isatty<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>streamOut <span class="token operator">=</span> sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write
            self<span class="token punctuation">.</span>streamFlush <span class="token operator">=</span> sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>flush
        <span class="token keyword">elif</span> stream <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">and</span> os<span class="token punctuation">.</span>isatty<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>streamOut <span class="token operator">=</span> sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>write
            self<span class="token punctuation">.</span>streamFlush <span class="token operator">=</span> sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>flush
        <span class="token keyword">elif</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> <span class="token string">'write'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>streamOut <span class="token operator">=</span> stream<span class="token punctuation">.</span>write
            self<span class="token punctuation">.</span>streamFlush <span class="token operator">=</span> stream<span class="token punctuation">.</span>flush
        self<span class="token punctuation">.</span>streamOut<span class="token punctuation">(</span>self<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>streamFlush<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>streamOut<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="复制（为作者贡献原力分）" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li></ul></pre> 
<p>sys.stdout.flush() 函数在每次迭代时手动刷新缓冲区，而sys.stdout.write() 代替 print()，并且对输出的字符做了一点变化。</p> 
<p>cv2.imread() 读取一个图片，返回一个 numpy.ndarray 对象。第一个参数为要打开的图片路径，第二个参数指定图片的打开方式，可以具有下面三个值：</p> 
<ul><li>cv2.IMREAD_COLOR : 加载彩色图片，忽略透明通道。</li><li>cv2.IMREAD_GRAYSCALE : 以灰度模式加载 图片。</li><li>cv2.IMREAD_UNCHANGED : 加载包含透明通道的图片。</li></ul> 
<p>show() 方法接受一个参数，表示使用哪种输出流。1 代表输出流使用标准输出 sys.stdout，2 代表输出流使用标准错误输出 sys.stderr。其中 sys.stdout.fileno() 和 sys.stderr.fileno() 分别返回标准输出和标准错误输出的文件描述符。os.isatty(fd) 返回一个布尔值，当文件描述符 fd 是打开并连接到 tty 设备时返回真。</p> 
<p>然后便是我们的重点了，继承自 CharFrame 类的 V2Char 类。</p> 
<p>先设想一下我们的类，类的其中一个属性为 charVideo ，这是一个列表，用来存放字符动画全部数据。</p> 
<p>然后是两个主要方法：一个是从视频文件转为字符动画的方法 genCharVideo()，一个是播放字符动画的方法 play()。</p> 
<p>另外由于从视频转到字符动画是一个耗时耗力的过程，所以我们可以把 charVideo 中的字符动画数据导出来，方便下次读取播放，这就意味着要有导出和读取方法，即 export() 方法和 load() 方法。</p> 
<p>类还要有一个初始化方法，参数为要读取的文件路径，文件若是导出的 txt，则调用 load() 方法把数据加载到属性 charVideo 里。否则视为视频文件，调用 genCharVideo() 方法将视频转化为字符动画存放到属性 charVideo 里：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">lass V2Char<span class="token punctuation">(</span>CharFrame<span class="token punctuation">)</span><span class="token punctuation">:</span>

    charVideo <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    timeInterval <span class="token operator">=</span> <span class="token number">0.033</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> path<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'txt'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>load<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>genCharVideo<span class="token punctuation">(</span>path<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">genCharVideo</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> filepath<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>charVideo <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>timeInterval <span class="token operator">=</span> <span class="token builtin">round</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span>cap<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
        nf <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>cap<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Generate char video, please wait...'</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> pyprind<span class="token punctuation">.</span>prog_bar<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>nf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            rawFrame <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
            frame <span class="token operator">=</span> self<span class="token punctuation">.</span>convert<span class="token punctuation">(</span>rawFrame<span class="token punctuation">,</span> os<span class="token punctuation">.</span>get_terminal_size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fill<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>charVideo<span class="token punctuation">.</span>append<span class="token punctuation">(</span>frame<span class="token punctuation">)</span>
        cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="复制（为作者贡献原力分）" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li></ul></pre> 
<p>用 cv2.VideoCapture() 方法读取视频文件，生成的对象我们赋值给 cap。</p> 
<p>通过 cap.get() 方法我们可以获得视频的属性信息，比如 cap.get(3) 和 cap.get(4) 分别返回视频的宽高信息，cap.get(5) 则返回视频的帧率，cap.get(7) 返回视频的总帧数。</p> 
<p>timeInterval 存放播放时间间隔，用来让之后播放字符动画的帧率与原视频相同。</p> 
<p>pyprind.prog_bar() 是一个生成器，使用这个生成器进行迭代会自然在终端中输出进度条。</p> 
<p>cap.read() 读取视频的下一帧，其返回一个两元素的元组，第一个元素为 bool 值，指示帧是否被正确读取，第二个元素为 numpy.ndarray ，其存放的便是帧的数据。</p> 
<p>cv2.cvtColor() 用来转换图像的颜色空间，第一个参数为图像对象，第二个参数指示转换类型，OpenCV 中有超过 150 个颜色空间转换，这里我们使用的是彩色转灰度 cv2.COLOR_BGR2GRAY。</p> 
<p>os.get_terminal_size() 方法返回当前终端的列数（宽），行数（高）。这里我们将 fill 参数设置为 True，未设置 wrap 参数，其值为默认的 False。在终端里如果打印的字符超过一行的宽度，终端会自动进行显示上的换行。</p> 
<p>然后是 play() 方法，这就要接着之前说了，要想终端不在播放字符动画后充满没用的字符，可以使用光标定位转义编码。</p> 
<p>我们可以这样：每输出一帧，就将光标移动到播放开始处，下一帧会从这个位置输出，并自动覆盖掉之前的内容，如此往复循环，播放完毕时，清除输出的最后一帧，这样终端就不会被字符画挤满了。</p> 
<p>这里是一系列用来定位光标的转义编码（某些终端不支持一些转义编码），引自 The Linux Command Line：</p> 
<div class="table-box"><table><thead><tr><th>转义编码</th><th>行动</th></tr></thead><tbody><tr><td>\033[l;cH</td><td>把光标移到第 l 行，第 c 列。</td></tr><tr><td>\033[nA</td><td>把光标向上移动 n 行。</td></tr><tr><td>\033[nB</td><td>把光标向下移动 n 行。</td></tr><tr><td>\033[nC</td><td>把光标向前移动 n 个字符。</td></tr><tr><td>\033[nD</td><td>把光标向后移动 n 个字符。</td></tr><tr><td>\033[2J</td><td>清空屏幕，把光标移到左上角（第零行，第零列）。</td></tr><tr><td>\033[K</td><td>清空从光标位置到当前行末的内容。</td></tr><tr><td>\033[s</td><td>存储当前光标位置。</td></tr><tr><td>\033[u</td><td>唤醒之前存储的光标位置。</td></tr></tbody></table></div>
<p>还有一个问题，如何在中途停止播放？当然你可以按 Ctrl + C，但这样程序是没办法做扫尾工作的，终端会留下一堆没用的乱七八糟的字符。</p> 
<p>我们这样设计，字符动画开始播放时启动一个守护线程，进程启动时便开始等待用户输入，一旦接收到输入便停止播放字符动画。</p> 
<p>这里有两个地方需要注意：</p> 
<ol><li>不要使用 input() 方法接收字符输入</li><li>不能使用普通线程</li></ol> 
<p>对于第一点，如果是想按任意字符终止播放的话，那么就不应该使用 input()，否则要么你按回车停止播放，要么按其他字符再敲回车停止播放，总而言之，使用 input() 并不舒服。最好的办法是，使用类似于 C 语言中的 getchar() 方法，然而 <a href="https://so.csdn.net/so/search?from=pc_blog_highlight&amp;q=python" target="_blank" class="hl hl-1">python</a> 并没有提供类似方法，这在后面的代码中会给出替代方案。</p> 
<p>对于第二点，我们要明白如果任何一个派生线程仍在运行中，主线程是不会退出的，除非派生线程被设定为守护线程。所以使用普通线程的话，若用户并没有在中途停止播放，等到播放完毕后，这个线程会永远的运行下去，直到用户输入任意字符。如果我们可以在播放完毕时手动 kill 掉这个派生线程，这也不是问题，然而 python 并没有提供 kill 掉线程的方法。所以，只能把这个派生线程设为守护线程。等主线程退出后，程序只剩下一个守护线程在运行，守护线程会自动被 kill 掉，程序退出。</p> 
<p>下面类 play() 方法的代码：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">def</span> <span class="token function">play</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> stream <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Bug:</span>
    <span class="token comment"># 光标定位转义编码不兼容 Windows</span>
    <span class="token keyword">if</span> <span class="token operator">not</span> self<span class="token punctuation">.</span>charVideo<span class="token punctuation">:</span>
        <span class="token keyword">return</span>
    <span class="token keyword">if</span> stream <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">and</span> os<span class="token punctuation">.</span>isatty<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>streamOut <span class="token operator">=</span> sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write
        self<span class="token punctuation">.</span>streamFlush <span class="token operator">=</span> sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>flush
    <span class="token keyword">elif</span> stream <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">and</span> os<span class="token punctuation">.</span>isatty<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>streamOut <span class="token operator">=</span> sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>write
        self<span class="token punctuation">.</span>streamFlush <span class="token operator">=</span> sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>flush
    <span class="token keyword">elif</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> <span class="token string">'write'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>streamOut <span class="token operator">=</span> stream<span class="token punctuation">.</span>write
        self<span class="token punctuation">.</span>streamFlush <span class="token operator">=</span> stream<span class="token punctuation">.</span>flush

    old_settings <span class="token operator">=</span> <span class="token boolean">None</span>
    breakflag <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token comment"># 获得标准输入的文件描述符</span>
    fd <span class="token operator">=</span> sys<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">getChar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">nonlocal</span> breakflag
        <span class="token keyword">nonlocal</span> old_settings
        <span class="token comment"># 保存标准输入的属性</span>
        old_settings <span class="token operator">=</span> termios<span class="token punctuation">.</span>tcgetattr<span class="token punctuation">(</span>fd<span class="token punctuation">)</span>
        <span class="token comment"># 设置标准输入为原始模式</span>
        tty<span class="token punctuation">.</span>setraw<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 读取一个字符</span>
        ch <span class="token operator">=</span> sys<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        breakflag <span class="token operator">=</span> <span class="token boolean">True</span> <span class="token keyword">if</span> ch <span class="token keyword">else</span> <span class="token boolean">False</span>

    <span class="token comment"># 创建线程</span>
    getchar <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>getChar<span class="token punctuation">)</span>
    <span class="token comment"># 设置为守护线程</span>
    getchar<span class="token punctuation">.</span>daemon <span class="token operator">=</span> <span class="token boolean">True</span>
    <span class="token comment"># 启动守护线程</span>
    getchar<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 输出的字符画行数</span>
    rows <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>charVideo<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">//</span>os<span class="token punctuation">.</span>get_terminal_size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> frame <span class="token keyword">in</span> self<span class="token punctuation">.</span>charVideo<span class="token punctuation">:</span>
        <span class="token comment"># 接收到输入则退出循环</span>
        <span class="token keyword">if</span> breakflag <span class="token keyword">is</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>
        self<span class="token punctuation">.</span>streamOut<span class="token punctuation">(</span>frame<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>streamFlush<span class="token punctuation">(</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>self<span class="token punctuation">.</span>timeInterval<span class="token punctuation">)</span>
        <span class="token comment"># 共 rows 行，光标上移 rows-1 行回到开始处</span>
        self<span class="token punctuation">.</span>streamOut<span class="token punctuation">(</span><span class="token string">'\033[{}A\r'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>rows<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 恢复标准输入为原来的属性</span>
    termios<span class="token punctuation">.</span>tcsetattr<span class="token punctuation">(</span>fd<span class="token punctuation">,</span> termios<span class="token punctuation">.</span>TCSADRAIN<span class="token punctuation">,</span> old_settings<span class="token punctuation">)</span>
    <span class="token comment"># 光标下移 rows-1 行到最后一行，清空最后一行</span>
    self<span class="token punctuation">.</span>streamOut<span class="token punctuation">(</span><span class="token string">'\033[{}B\033[K'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>rows<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 清空最后一帧的所有行（从倒数第二行起）</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>rows<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 光标上移一行</span>
        self<span class="token punctuation">.</span>streamOut<span class="token punctuation">(</span><span class="token string">'\033[1A'</span><span class="token punctuation">)</span>
        <span class="token comment"># 清空光标所在行</span>
        self<span class="token punctuation">.</span>streamOut<span class="token punctuation">(</span><span class="token string">'\r\033[K'</span><span class="token punctuation">)</span>
    info <span class="token operator">=</span> <span class="token string">'User interrupt!\n'</span> <span class="token keyword">if</span> breakflag <span class="token keyword">else</span> <span class="token string">'Finished!\n'</span>
    self<span class="token punctuation">.</span>streamOut<span class="token punctuation">(</span>info<span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="复制（为作者贡献原力分）" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li><li style="color: rgb(153, 153, 153);">48</li><li style="color: rgb(153, 153, 153);">49</li><li style="color: rgb(153, 153, 153);">50</li><li style="color: rgb(153, 153, 153);">51</li><li style="color: rgb(153, 153, 153);">52</li><li style="color: rgb(153, 153, 153);">53</li><li style="color: rgb(153, 153, 153);">54</li><li style="color: rgb(153, 153, 153);">55</li><li style="color: rgb(153, 153, 153);">56</li><li style="color: rgb(153, 153, 153);">57</li><li style="color: rgb(153, 153, 153);">58</li><li style="color: rgb(153, 153, 153);">59</li><li style="color: rgb(153, 153, 153);">60</li></ul></pre> 
<p>那么直接上最终代码吧：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">import</span> sys
<span class="token keyword">import</span> os
<span class="token keyword">import</span> time
<span class="token keyword">import</span> threading
<span class="token keyword">import</span> termios
<span class="token keyword">import</span> tty
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> pyprind


<span class="token keyword">class</span> <span class="token class-name">CharFrame</span><span class="token punctuation">:</span>

    ascii_char <span class="token operator">=</span> <span class="token string">"$@B%8&amp;WM#*oahkbdpqwmZO0QLCJUYXzcvunxrjft/\|()1{}[]?-_+~&lt;&gt;i!lI;:,\"^`'. "</span>

    <span class="token comment"># 像素映射到字符</span>
    <span class="token keyword">def</span> <span class="token function">pixelToChar</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> luminance<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>ascii_char<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>luminance<span class="token operator">/</span><span class="token number">256</span><span class="token operator">*</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>ascii_char<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

    <span class="token comment"># 将普通帧转为 ASCII 字符帧</span>
    <span class="token keyword">def</span> <span class="token function">convert</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> img<span class="token punctuation">,</span> limitSize<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> fill<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> wrap<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> limitSize <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">and</span> <span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> limitSize<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">or</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> limitSize<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>img<span class="token punctuation">,</span> limitSize<span class="token punctuation">,</span> interpolation<span class="token operator">=</span>cv2<span class="token punctuation">.</span>INTER_AREA<span class="token punctuation">)</span>
        ascii_frame <span class="token operator">=</span> <span class="token string">''</span>
        blank <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token keyword">if</span> fill<span class="token punctuation">:</span>
            blank <span class="token operator">+=</span> <span class="token string">' '</span><span class="token operator">*</span><span class="token punctuation">(</span>limitSize<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> wrap<span class="token punctuation">:</span>
            blank <span class="token operator">+=</span> <span class="token string">'\n'</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                ascii_frame <span class="token operator">+=</span> self<span class="token punctuation">.</span>pixelToChar<span class="token punctuation">(</span>img<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
            ascii_frame <span class="token operator">+=</span> blank
        <span class="token keyword">return</span> ascii_frame


<span class="token keyword">class</span> <span class="token class-name">I2Char</span><span class="token punctuation">(</span>CharFrame<span class="token punctuation">)</span><span class="token punctuation">:</span>

    result <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">,</span> limitSize<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> fill<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> wrap<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>genCharImage<span class="token punctuation">(</span>path<span class="token punctuation">,</span> limitSize<span class="token punctuation">,</span> fill<span class="token punctuation">,</span> wrap<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">genCharImage</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">,</span> limitSize<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> fill<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> wrap<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>path<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>IMREAD_GRAYSCALE<span class="token punctuation">)</span>
        <span class="token keyword">if</span> img <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        self<span class="token punctuation">.</span>result <span class="token operator">=</span> self<span class="token punctuation">.</span>convert<span class="token punctuation">(</span>img<span class="token punctuation">,</span> limitSize<span class="token punctuation">,</span> fill<span class="token punctuation">,</span> wrap<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> stream <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>result <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        <span class="token keyword">if</span> stream <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">and</span> os<span class="token punctuation">.</span>isatty<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>streamOut <span class="token operator">=</span> sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write
            self<span class="token punctuation">.</span>streamFlush <span class="token operator">=</span> sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>flush
        <span class="token keyword">elif</span> stream <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">and</span> os<span class="token punctuation">.</span>isatty<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>streamOut <span class="token operator">=</span> sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>write
            self<span class="token punctuation">.</span>streamFlush <span class="token operator">=</span> sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>flush
        <span class="token keyword">elif</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> <span class="token string">'write'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>streamOut <span class="token operator">=</span> stream<span class="token punctuation">.</span>write
            self<span class="token punctuation">.</span>streamFlush <span class="token operator">=</span> stream<span class="token punctuation">.</span>flush
        self<span class="token punctuation">.</span>streamOut<span class="token punctuation">(</span>self<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>streamFlush<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>streamOut<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">V2Char</span><span class="token punctuation">(</span>CharFrame<span class="token punctuation">)</span><span class="token punctuation">:</span>

    charVideo <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    timeInterval <span class="token operator">=</span> <span class="token number">0.033</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> path<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'txt'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>load<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>genCharVideo<span class="token punctuation">(</span>path<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">genCharVideo</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> filepath<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>charVideo <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>timeInterval <span class="token operator">=</span> <span class="token builtin">round</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span>cap<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
        nf <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>cap<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Generate char video, please wait...'</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> pyprind<span class="token punctuation">.</span>prog_bar<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>nf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            rawFrame <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
            frame <span class="token operator">=</span> self<span class="token punctuation">.</span>convert<span class="token punctuation">(</span>rawFrame<span class="token punctuation">,</span> os<span class="token punctuation">.</span>get_terminal_size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fill<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>charVideo<span class="token punctuation">.</span>append<span class="token punctuation">(</span>frame<span class="token punctuation">)</span>
        cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">export</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> filepath<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token operator">not</span> self<span class="token punctuation">.</span>charVideo<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filepath<span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            <span class="token keyword">for</span> frame <span class="token keyword">in</span> self<span class="token punctuation">.</span>charVideo<span class="token punctuation">:</span>
                <span class="token comment"># 加一个换行符用以分隔每一帧</span>
                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>frame <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">load</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> filepath<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>charVideo <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token comment"># 一行即为一帧</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span>  <span class="token builtin">open</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>charVideo<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">play</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> stream <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Bug:</span>
        <span class="token comment"># 光标定位转义编码不兼容 Windows</span>
        <span class="token keyword">if</span> <span class="token operator">not</span> self<span class="token punctuation">.</span>charVideo<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        <span class="token keyword">if</span> stream <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">and</span> os<span class="token punctuation">.</span>isatty<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>streamOut <span class="token operator">=</span> sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write
            self<span class="token punctuation">.</span>streamFlush <span class="token operator">=</span> sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>flush
        <span class="token keyword">elif</span> stream <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">and</span> os<span class="token punctuation">.</span>isatty<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>streamOut <span class="token operator">=</span> sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>write
            self<span class="token punctuation">.</span>streamFlush <span class="token operator">=</span> sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>flush
        <span class="token keyword">elif</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> <span class="token string">'write'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>streamOut <span class="token operator">=</span> stream<span class="token punctuation">.</span>write
            self<span class="token punctuation">.</span>streamFlush <span class="token operator">=</span> stream<span class="token punctuation">.</span>flush

        old_settings <span class="token operator">=</span> <span class="token boolean">None</span>
        breakflag <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token comment"># 获得标准输入的文件描述符</span>
        fd <span class="token operator">=</span> sys<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">def</span> <span class="token function">getChar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">nonlocal</span> breakflag
            <span class="token keyword">nonlocal</span> old_settings
            <span class="token comment"># 保存标准输入的属性</span>
            old_settings <span class="token operator">=</span> termios<span class="token punctuation">.</span>tcgetattr<span class="token punctuation">(</span>fd<span class="token punctuation">)</span>
            <span class="token comment"># 设置标准输入为原始模式</span>
            tty<span class="token punctuation">.</span>setraw<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment"># 读取一个字符</span>
            ch <span class="token operator">=</span> sys<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            breakflag <span class="token operator">=</span> <span class="token boolean">True</span> <span class="token keyword">if</span> ch <span class="token keyword">else</span> <span class="token boolean">False</span>

        <span class="token comment"># 创建线程</span>
        getchar <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>getChar<span class="token punctuation">)</span>
        <span class="token comment"># 设置为守护线程</span>
        getchar<span class="token punctuation">.</span>daemon <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token comment"># 启动守护线程</span>
        getchar<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 输出的字符画行数</span>
        rows <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>charVideo<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">//</span>os<span class="token punctuation">.</span>get_terminal_size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> frame <span class="token keyword">in</span> self<span class="token punctuation">.</span>charVideo<span class="token punctuation">:</span>
            <span class="token comment"># 接收到输入则退出循环</span>
            <span class="token keyword">if</span> breakflag <span class="token keyword">is</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span>
            self<span class="token punctuation">.</span>streamOut<span class="token punctuation">(</span>frame<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>streamFlush<span class="token punctuation">(</span><span class="token punctuation">)</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>self<span class="token punctuation">.</span>timeInterval<span class="token punctuation">)</span>
            <span class="token comment"># 共 rows 行，光标上移 rows-1 行回到开始处</span>
            self<span class="token punctuation">.</span>streamOut<span class="token punctuation">(</span><span class="token string">'\033[{}A\r'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>rows<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 恢复标准输入为原来的属性</span>
        termios<span class="token punctuation">.</span>tcsetattr<span class="token punctuation">(</span>fd<span class="token punctuation">,</span> termios<span class="token punctuation">.</span>TCSADRAIN<span class="token punctuation">,</span> old_settings<span class="token punctuation">)</span>
        <span class="token comment"># 光标下移 rows-1 行到最后一行，清空最后一行</span>
        self<span class="token punctuation">.</span>streamOut<span class="token punctuation">(</span><span class="token string">'\033[{}B\033[K'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>rows<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 清空最后一帧的所有行（从倒数第二行起）</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>rows<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 光标上移一行</span>
            self<span class="token punctuation">.</span>streamOut<span class="token punctuation">(</span><span class="token string">'\033[1A'</span><span class="token punctuation">)</span>
            <span class="token comment"># 清空光标所在行</span>
            self<span class="token punctuation">.</span>streamOut<span class="token punctuation">(</span><span class="token string">'\r\033[K'</span><span class="token punctuation">)</span>
        info <span class="token operator">=</span> <span class="token string">'User interrupt!\n'</span> <span class="token keyword">if</span> breakflag <span class="token keyword">else</span> <span class="token string">'Finished!\n'</span>
        self<span class="token punctuation">.</span>streamOut<span class="token punctuation">(</span>info<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">import</span> argparse
    <span class="token comment"># 设置命令行参数</span>
    parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span>
                        <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Video file or charvideo file'</span><span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-e'</span><span class="token punctuation">,</span> <span class="token string">'--export'</span><span class="token punctuation">,</span> nargs <span class="token operator">=</span> <span class="token string">'?'</span><span class="token punctuation">,</span> const <span class="token operator">=</span> <span class="token string">'charvideo.txt'</span><span class="token punctuation">,</span>
                        <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Export charvideo file'</span><span class="token punctuation">)</span>
    <span class="token comment"># 获取参数</span>
    args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>
    v2char <span class="token operator">=</span> V2Char<span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token builtin">file</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> args<span class="token punctuation">.</span>export<span class="token punctuation">:</span>
        v2char<span class="token punctuation">.</span>export<span class="token punctuation">(</span>args<span class="token punctuation">.</span>export<span class="token punctuation">)</span>
    v2char<span class="token punctuation">.</span>play<span class="token punctuation">(</span><span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="复制（为作者贡献原力分）" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li><li style="color: rgb(153, 153, 153);">48</li><li style="color: rgb(153, 153, 153);">49</li><li style="color: rgb(153, 153, 153);">50</li><li style="color: rgb(153, 153, 153);">51</li><li style="color: rgb(153, 153, 153);">52</li><li style="color: rgb(153, 153, 153);">53</li><li style="color: rgb(153, 153, 153);">54</li><li style="color: rgb(153, 153, 153);">55</li><li style="color: rgb(153, 153, 153);">56</li><li style="color: rgb(153, 153, 153);">57</li><li style="color: rgb(153, 153, 153);">58</li><li style="color: rgb(153, 153, 153);">59</li><li style="color: rgb(153, 153, 153);">60</li><li style="color: rgb(153, 153, 153);">61</li><li style="color: rgb(153, 153, 153);">62</li><li style="color: rgb(153, 153, 153);">63</li><li style="color: rgb(153, 153, 153);">64</li><li style="color: rgb(153, 153, 153);">65</li><li style="color: rgb(153, 153, 153);">66</li><li style="color: rgb(153, 153, 153);">67</li><li style="color: rgb(153, 153, 153);">68</li><li style="color: rgb(153, 153, 153);">69</li><li style="color: rgb(153, 153, 153);">70</li><li style="color: rgb(153, 153, 153);">71</li><li style="color: rgb(153, 153, 153);">72</li><li style="color: rgb(153, 153, 153);">73</li><li style="color: rgb(153, 153, 153);">74</li><li style="color: rgb(153, 153, 153);">75</li><li style="color: rgb(153, 153, 153);">76</li><li style="color: rgb(153, 153, 153);">77</li><li style="color: rgb(153, 153, 153);">78</li><li style="color: rgb(153, 153, 153);">79</li><li style="color: rgb(153, 153, 153);">80</li><li style="color: rgb(153, 153, 153);">81</li><li style="color: rgb(153, 153, 153);">82</li><li style="color: rgb(153, 153, 153);">83</li><li style="color: rgb(153, 153, 153);">84</li><li style="color: rgb(153, 153, 153);">85</li><li style="color: rgb(153, 153, 153);">86</li><li style="color: rgb(153, 153, 153);">87</li><li style="color: rgb(153, 153, 153);">88</li><li style="color: rgb(153, 153, 153);">89</li><li style="color: rgb(153, 153, 153);">90</li><li style="color: rgb(153, 153, 153);">91</li><li style="color: rgb(153, 153, 153);">92</li><li style="color: rgb(153, 153, 153);">93</li><li style="color: rgb(153, 153, 153);">94</li><li style="color: rgb(153, 153, 153);">95</li><li style="color: rgb(153, 153, 153);">96</li><li style="color: rgb(153, 153, 153);">97</li><li style="color: rgb(153, 153, 153);">98</li><li style="color: rgb(153, 153, 153);">99</li><li style="color: rgb(153, 153, 153);">100</li><li style="color: rgb(153, 153, 153);">101</li><li style="color: rgb(153, 153, 153);">102</li><li style="color: rgb(153, 153, 153);">103</li><li style="color: rgb(153, 153, 153);">104</li><li style="color: rgb(153, 153, 153);">105</li><li style="color: rgb(153, 153, 153);">106</li><li style="color: rgb(153, 153, 153);">107</li><li style="color: rgb(153, 153, 153);">108</li><li style="color: rgb(153, 153, 153);">109</li><li style="color: rgb(153, 153, 153);">110</li><li style="color: rgb(153, 153, 153);">111</li><li style="color: rgb(153, 153, 153);">112</li><li style="color: rgb(153, 153, 153);">113</li><li style="color: rgb(153, 153, 153);">114</li><li style="color: rgb(153, 153, 153);">115</li><li style="color: rgb(153, 153, 153);">116</li><li style="color: rgb(153, 153, 153);">117</li><li style="color: rgb(153, 153, 153);">118</li><li style="color: rgb(153, 153, 153);">119</li><li style="color: rgb(153, 153, 153);">120</li><li style="color: rgb(153, 153, 153);">121</li><li style="color: rgb(153, 153, 153);">122</li><li style="color: rgb(153, 153, 153);">123</li><li style="color: rgb(153, 153, 153);">124</li><li style="color: rgb(153, 153, 153);">125</li><li style="color: rgb(153, 153, 153);">126</li><li style="color: rgb(153, 153, 153);">127</li><li style="color: rgb(153, 153, 153);">128</li><li style="color: rgb(153, 153, 153);">129</li><li style="color: rgb(153, 153, 153);">130</li><li style="color: rgb(153, 153, 153);">131</li><li style="color: rgb(153, 153, 153);">132</li><li style="color: rgb(153, 153, 153);">133</li><li style="color: rgb(153, 153, 153);">134</li><li style="color: rgb(153, 153, 153);">135</li><li style="color: rgb(153, 153, 153);">136</li><li style="color: rgb(153, 153, 153);">137</li><li style="color: rgb(153, 153, 153);">138</li><li style="color: rgb(153, 153, 153);">139</li><li style="color: rgb(153, 153, 153);">140</li><li style="color: rgb(153, 153, 153);">141</li><li style="color: rgb(153, 153, 153);">142</li><li style="color: rgb(153, 153, 153);">143</li><li style="color: rgb(153, 153, 153);">144</li><li style="color: rgb(153, 153, 153);">145</li><li style="color: rgb(153, 153, 153);">146</li><li style="color: rgb(153, 153, 153);">147</li><li style="color: rgb(153, 153, 153);">148</li><li style="color: rgb(153, 153, 153);">149</li><li style="color: rgb(153, 153, 153);">150</li><li style="color: rgb(153, 153, 153);">151</li><li style="color: rgb(153, 153, 153);">152</li><li style="color: rgb(153, 153, 153);">153</li><li style="color: rgb(153, 153, 153);">154</li><li style="color: rgb(153, 153, 153);">155</li><li style="color: rgb(153, 153, 153);">156</li><li style="color: rgb(153, 153, 153);">157</li><li style="color: rgb(153, 153, 153);">158</li><li style="color: rgb(153, 153, 153);">159</li><li style="color: rgb(153, 153, 153);">160</li><li style="color: rgb(153, 153, 153);">161</li><li style="color: rgb(153, 153, 153);">162</li><li style="color: rgb(153, 153, 153);">163</li><li style="color: rgb(153, 153, 153);">164</li><li style="color: rgb(153, 153, 153);">165</li><li style="color: rgb(153, 153, 153);">166</li><li style="color: rgb(153, 153, 153);">167</li><li style="color: rgb(153, 153, 153);">168</li><li style="color: rgb(153, 153, 153);">169</li><li style="color: rgb(153, 153, 153);">170</li><li style="color: rgb(153, 153, 153);">171</li><li style="color: rgb(153, 153, 153);">172</li><li style="color: rgb(153, 153, 153);">173</li><li style="color: rgb(153, 153, 153);">174</li><li style="color: rgb(153, 153, 153);">175</li><li style="color: rgb(153, 153, 153);">176</li><li style="color: rgb(153, 153, 153);">177</li></ul></pre> 
<p>关于测试，如果看了我上一篇局域网视频聊天，以及本篇中给出的图片转字符画链接，进去后会发现有去年我画的argparse的思维导图，简单介绍了一下，那么下面直接给出测试方法：</p> 
<p>输入如下命令将 xxx.mp4 文件转为字符动画并导出为文件，同时播放转换后的字符动画（转码过程可能需要几分钟的时间，请耐心等待）。</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">$ python3 CLIPlayVideo<span class="token punctuation">.</span>py xxx<span class="token punctuation">.</span>mp4 <span class="token operator">-</span>e
<div class="hljs-button {2}" data-title="复制（为作者贡献原力分）" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>之后再次播放不必重新转换一次，可以直接读取导出的字符画，假设这个文件是 charvideo.txt：</p> 
<pre class="prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">$ python3 CLIPlayVideo<span class="token punctuation">.</span>py charvideo<span class="token punctuation">.</span>txt
<div class="hljs-button {2}" data-title="复制（为作者贡献原力分）" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<h1><a name="t6"></a><a id="_484"></a>总结</h1> 
<p>这里我还是拿B站的MAD做实验，因为视频本身比较大，另外时长也比较长，所以当运行程序后，会发现等待时间也比较长：<br> <img src="https://img-blog.csdnimg.cn/20200531235243547.png" alt="在这里插入图片描述"><br> 待等待时间过后，我们可以看见终端呈现的效果，因为csdn最大为5M，部分效果：</p> 
<p><img src="https://img-blog.csdnimg.cn/20200531235509254.gif#pic_center" alt="在这里插入图片描述"></p>
                </div><div><div></div></div>
                <link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-d7a94ec6ab.css" rel="stylesheet">
                <link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-49037e4d27.css" rel="stylesheet">
        </div>